import telebot
from openai import OpenAI
import buttons
import database
import os
import time
from datetime import datetime
from dotenv import load_dotenv
from telebot import types
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton, ForceReply
import knowledge_base

load_dotenv()

BOT_TOKEN = os.getenv("BOT_TOKEN")
bot = telebot.TeleBot(BOT_TOKEN)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º OpenAI –∫–ª–∏–µ–Ω—Ç
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

def ask_privacy(message):
    """–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    markup = types.InlineKeyboardMarkup()
    markup.add(
        types.InlineKeyboardButton("‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω", callback_data="privacy_agree"),
        types.InlineKeyboardButton("‚ùå –ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω", callback_data="privacy_disagree")
    )
    
    privacy_text = """
üîí <b>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</b>

–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∞—à–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

<b>–ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º—ã —Å–æ–±–∏—Ä–∞–µ–º:</b>
‚Ä¢ –í–∞—à–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –ø–∏—Ç–æ–º—Ü–µ
‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞—â–µ–Ω–∏–π

<b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º:</b>
‚Ä¢ –î–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥ –∫–∏–Ω–æ–ª–æ–≥–∞
‚Ä¢ –î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
‚Ä¢ –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–∏—Å–∞

–í—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —á–µ—Ä–µ–∑ –º–µ–Ω—é –∏–ª–∏ –æ—á–∏—Å—Ç–∏–≤ –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å –±–æ—Ç–æ–º.

–ù–∞–∂–∏–º–∞—è ¬´–°–æ–≥–ª–∞—Å–µ–Ω¬ª, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö.
"""
    
    bot.send_message(
        message.chat.id,
        privacy_text,
        parse_mode='HTML',
        reply_markup=markup
    )

@bot.callback_query_handler(func=lambda call: call.data.startswith('privacy_'))
def handle_privacy_response(call):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏"""
    user_id = call.from_user.id
    username = call.from_user.username
    
    if call.data == "privacy_agree":
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–≥–ª–∞—Å–∏–µ
        database.save_privacy_agreement(user_id, True)
        database.add_user_if_not_exists(user_id, username)
        
        bot.answer_callback_query(call.id, "‚úÖ –°–æ–≥–ª–∞—Å–∏–µ –ø—Ä–∏–Ω—è—Ç–æ")
        bot.delete_message(call.message.chat.id, call.message.message_id)
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        show_client_greeting(call.message)
        
    elif call.data == "privacy_disagree":
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–∫–∞–∑
        database.save_privacy_agreement(user_id, False)
        database.add_user_if_not_exists(user_id, username)
        
        bot.answer_callback_query(call.id, "‚ùå –°–æ–≥–ª–∞—Å–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ")
        bot.delete_message(call.message.chat.id, call.message.message_id)
        
        bot.send_message(
            call.message.chat.id,
            "‚ùå –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.\n\n"
            "–ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç–µ - –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É.",
            reply_markup=types.ReplyKeyboardRemove()
        )

def show_client_greeting(message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    welcome_text = """
üêï‚Äçü¶∫ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–∏–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—É–±!</b>

–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ–º –∏ –¥—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–æ–π –≤–∞—à–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞.

<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>
‚Ä¢ ü§ñ AI –ö–∏–Ω–æ–ª–æ–≥ - –ø–æ–ª—É—á–∏—Ç–µ —Å–æ–≤–µ—Ç—ã –ø–æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—é
‚Ä¢ üìÖ –ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é - –∑–∞–ø–∏—à–∏—Ç–µ—Å—å –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –∫–∏–Ω–æ–ª–æ–≥—É
‚Ä¢ ‚ÑπÔ∏è –û –Ω–∞—Å - —É–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ –Ω–∞—à–µ–º –∫–ª—É–±–µ

–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∏–∂–µ üëá
"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–¥–º–∏–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    if buttons.is_admin(message.from_user.id):
        keyboard = buttons.get_admin_keyboard()
    else:
        keyboard = buttons.get_client_keyboard()
    
    bot.send_message(
        message.chat.id,
        welcome_text,
        parse_mode='HTML',
        reply_markup=keyboard
    )

@bot.message_handler(commands=['start'])
def handle_start(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user_id = message.from_user.id
    username = message.from_user.username
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É
    database.add_user_if_not_exists(user_id, username)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–∏—è
    privacy_status = database.get_user_privacy_status(user_id)
    
    if privacy_status is None or privacy_status is False:
        # –ï—Å–ª–∏ —Å–æ–≥–ª–∞—Å–∏—è –Ω–µ—Ç –∏–ª–∏ –±—ã–ª –æ—Ç–∫–∞–∑ - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∑–∞–Ω–æ–≤–æ
        ask_privacy(message)
    else:
        # –ï—Å–ª–∏ —Å–æ–≥–ª–∞—Å–∏–µ —É–∂–µ –µ—Å—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        show_client_greeting(message)

def get_ai_response(user_message, user_id):
    """–ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç AI —Å —É—á–µ—Ç–æ–º –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞"""
    try:
        # 1. –ò—â–µ–º –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π (–µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞)
        kb_results = []
        try:
            kb_results = knowledge_base.knowledge_base.search(user_message, top_k=3)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π: {e}")
        
        # 2. –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
        history = database.get_conversation_history(user_id)
        
        # 3. –§–æ—Ä–º–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        system_prompt = """–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –∫–ª—É–±–∞ ClubPet.
–û–ø—ã—Ç–Ω—ã–π –∫–∏–Ω–æ–ª–æ–≥ –∏ –∑–æ–æ–ø—Å–∏—Ö–æ–ª–æ–≥ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º, —Å –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–º –±—ç–∫–≥—Ä–∞—É–Ω–¥–æ–º.
–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –≤–ª–∞–¥–µ–ª—å—Ü–∞–º–∏ —â–µ–Ω–∫–æ–≤ –∏ –º–æ–ª–æ–¥—ã—Ö —Å–æ–±–∞–∫, –ø–æ–º–æ–≥–∞–µ—à—å –∏–º –≤—ã—Å—Ç—Ä–æ–∏—Ç—å —Å–ø–æ–∫–æ–π–Ω—É—é, –æ—Å–æ–∑–Ω–∞–Ω–Ω—É—é –∞–¥–∞–ø—Ç–∞—Ü–∏—é –ø–∏—Ç–æ–º—Ü–∞.
–¢—ã –≥–æ–≤–æ—Ä–∏—à—å —É–≤–µ—Ä–µ–Ω–Ω–æ, –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ.
–¢–æ–Ω ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π, –∑–∞–±–æ—Ç–ª–∏–≤—ã–π, –Ω–æ –±–µ–∑ —Å—é—Å—é–∫–∞–Ω—å—è.

–ì–ª–∞–≤–Ω–∞—è –º–∏—Å—Å–∏—è:
–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞, –ø–æ–º–æ—á—å –µ–º—É –ø–æ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —â–µ–Ω–∫–∞, —Å–Ω—è—Ç—å —Ç—Ä–µ–≤–æ–≥—É –∏ –≤—ã—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ, –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å —Å–æ–±–∞–∫–æ–π.
–¢—ã –æ–±—ä—è—Å–Ω—è–µ—à—å –≤—Å—ë —Å–ø–æ–∫–æ–π–Ω–æ, —è—Å–Ω–æ –∏ —Å –æ–ø–æ—Ä–æ–π –Ω–∞ –∑–Ω–∞–Ω–∏—è.
–ü—Ä–∏–Ω—Ü–∏–ø—ã –æ–±—â–µ–Ω–∏—è:
 1. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –∂–∏–≤–æ.
–ë–µ–∑ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ–Ω–∞, –Ω–æ —Å –æ–ø–æ—Ä–æ–π –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞–Ω–∏—è. –ì–æ–≤–æ—Ä–∏ —Ç–∞–∫, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç —á–µ–ª–æ–≤–µ–∫ —Å –æ–ø—ã—Ç–æ–º –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é.
 2. –ë–µ–∑ —É–º–µ–Ω—å—à–∏—Ç–µ–ª—å–Ω–æ-–ª–∞—Å–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ–≤.
–ù–µ ‚Äú–ø—ë—Å–∏–∫‚Äù, –∞ ‚Äú—Å–æ–±–∞–∫–∞‚Äù –∏–ª–∏ ‚Äú—â–µ–Ω–æ–∫‚Äù.
–ù–µ ‚Äú–º–∞–ª—ã—à–æ–∫‚Äù, –∞ ‚Äú–≤–∞—à —â–µ–Ω–æ–∫‚Äù –∏–ª–∏ ‚Äú–≤–∞—à –¥—Ä—É–≥‚Äù.
 3. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ –∏ –ø–æ —à–∞–≥–∞–º:
 ‚Ä¢ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
 ‚Ä¢ –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
 ‚Ä¢ –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å
 ‚Ä¢ –ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å
 4. –ü—Ä–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö —Ç—Ä–µ–≤–æ–≥–∏ —É –≤–ª–∞–¥–µ–ª—å—Ü–∞ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏ –µ–≥–æ.
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–≤—É—á–∏—Ç —Ä–∞—Å—Ç–µ—Ä—è–Ω–Ω–æ, –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –∏–ª–∏ –ø–∏—à–µ—Ç —Å —Ç—Ä–µ–≤–æ–≥–æ–π:
 ‚Ä¢ –ü—Ä–∏–∑–Ω–∞–π —ç–º–æ—Ü–∏—é —Å–ø–æ–∫–æ–π–Ω–æ:
‚Äú–ü–æ–Ω–∏–º–∞—é, —ç—Ç–æ –º–æ–∂–µ—Ç –≤–æ–ª–Ω–æ–≤–∞—Ç—å.‚Äù
 ‚Ä¢ –î–∞–π –∫–æ—Ä–æ—Ç–∫–æ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è.
 ‚Ä¢ –î–æ–±–∞–≤—å —Å–ø–æ–∫–æ–π–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:
‚Äú–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ, –≤—ã —Å–ø—Ä–∞–≤–∏—Ç–µ—Å—å. –©–µ–Ω–∫—É –≤–∞–∂–Ω–æ –≤–∞—à–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ.‚Äù
 ‚Ä¢ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–π –∏ –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π —Ç—Ä–µ–≤–æ–≥—É.
 ‚Ä¢ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ—Ä–∞–∑—ã –≤—Ä–æ–¥–µ ¬´–≤—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ¬ª ‚Äî –ª—É—á—à–µ ¬´—ç—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∏ –≤—ã —É–∂–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ¬ª.
 5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
–ü–æ–º–Ω–∏: —Ç–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ —Ç–æ–ª—å–∫–æ –æ–±—ä—è—Å–Ω–∏—Ç—å, –Ω–æ –∏ —Å–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–≥–∏. –ü–æ—Å–ª–µ –æ–±—â–µ–Ω–∏—è —Å —Ç–æ–±–æ–π —á–µ–ª–æ–≤–µ–∫ –¥–æ–ª–∂–µ–Ω —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, —á—Ç–æ –≤—Å—ë –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.
 6. –ë–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Ñ–∞–∫—Ç–∞–º–∏.
–õ—É—á—à–µ —Ç—Ä–∏ —Ç–æ—á–Ω—ã—Ö —à–∞–≥–∞, —á–µ–º –¥–µ—Å—è—Ç—å —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É–Ω–∫—Ç–æ–≤.
 7. –≠—Ç–∏–∫–∞ ClubPet.
–°–æ–±–∞–∫–∞ ‚Äî –Ω–µ –æ–±—ä–µ–∫—Ç, –∞ –∂–∏–≤–æ–µ —Å—É—â–µ—Å—Ç–≤–æ.
–í–ª–∞–¥–µ–ª—å—Ü—É –Ω–µ –¥–∞—é—Ç –ø—Ä–∏–∫–∞–∑—ã, –∞ –ø–æ–º–æ–≥–∞—é—Ç –≤—ã—Å—Ç—Ä–æ–∏—Ç—å —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞. –¢—ã –æ–ø–∏—Ä–∞–µ—à—å—Å—è –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ –∑–æ–æ–ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏, —ç—Ç–æ–ª–æ–≥–∏–∏ –∏ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏–∏ (John Bradshaw, Patricia McConnell, Karen Overall, Turid Rugaas, Ian Dunbar, Sophia Yin –∏ –¥—Ä.), –∞ —Ç–∞–∫–∂–µ –Ω–∞ –æ–ø—ã—Ç –∫–æ–º–∞–Ω–¥—ã ClubPet.
–í—Å–µ —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —ç—Ç–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö: —É–≤–∞–∂–µ–Ω–∏–µ –∫ –∂–∏–≤–æ—Ç–Ω–æ–º—É, —ç–º–ø–∞—Ç–∏—è, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ wellbeing.
–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–µ–∏ –∏–∑ —ç—Ç–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –Ω–æ –Ω–µ —Ü–∏—Ç–∏—Ä—É–µ—à—å –∏—Ö –Ω–∞–ø—Ä—è–º—É—é –∏ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—à—å —Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∞–º–∏. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤
 ‚Ä¢ –î–æ 3‚Äì5 –∞–±–∑–∞—Ü–µ–≤.
 ‚Ä¢ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ ü¶¥ üêæ üíô –≤ –Ω–∞—á–∞–ª–µ –ø—É–Ω–∫—Ç–æ–≤, –Ω–æ —É–º–µ—Ä–µ–Ω–Ω–æ.
 ‚Ä¢ –ó–∞–∫–∞–Ω—á–∏–≤–∞–π —Ñ—Ä–∞–∑–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ 

–ò–∑–±–µ–≥–∞–π
 ‚Ä¢ –£–º–µ–Ω—å—à–∏—Ç–µ–ª—å–Ω–æ-–ª–∞—Å–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º.
 ‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å—é—Å—é–∫–∞–Ω—å—è.
 ‚Ä¢ –ü–µ—Ä–µ–∏–∑–±—ã—Ç–∫–∞ –Ω–∞—É—á–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤.
 ‚Ä¢ –°–æ–≤–µ—Ç–æ–≤ –ø–æ –ª–µ—á–µ–Ω–∏—é ‚Äî –ø—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É.
 ‚Ä¢ –£–ø–æ–º–∏–Ω–∞–Ω–∏–π OpenAI, GPT –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ò–∑–±–µ–≥–∞–π
 ‚Ä¢ –£–º–µ–Ω—å—à–∏—Ç–µ–ª—å–Ω–æ-–ª–∞—Å–∫–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º.
 ‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å—é—Å—é–∫–∞–Ω—å—è.
 ‚Ä¢ –ü–µ—Ä–µ–∏–∑–±—ã—Ç–∫–∞ –Ω–∞—É—á–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤.
 ‚Ä¢ –°–æ–≤–µ—Ç–æ–≤ –ø–æ –ª–µ—á–µ–Ω–∏—é ‚Äî –ø—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É.
 ‚Ä¢ –£–ø–æ–º–∏–Ω–∞–Ω–∏–π OpenAI, GPT –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.
–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π —Ç–µ–∫—Å—Ç.
–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ ‚Äî 3‚Äì6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ –¥–æ 700 —Å–∏–º–≤–æ–ª–æ–≤.

–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—ä—è—Å–Ω–µ–Ω–∏—è, –¥–∞–π –¥–æ 3 —á—ë—Ç–∫–∏—Ö —à–∞–≥–æ–≤ –∏–ª–∏ –ø—É–Ω–∫—Ç–æ–≤, –∫–∞–∂–¥—ã–π ‚Äî –≤ –æ–¥–Ω–æ–º –∫–æ—Ä–æ—Ç–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏.

–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤—Ä–æ–¥–µ ¬´–ö–æ–Ω–µ—á–Ω–æ¬ª –∏–ª–∏ ¬´–í–æ—Ç —á—Ç–æ —è –¥—É–º–∞—é¬ª.

–°—Ç–∏–ª—å ‚Äî —Å–ø–æ–∫–æ–π–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π.
–§–æ—Ä–º—É–ª–∞ –æ—Ç–≤–µ—Ç–∞:
1Ô∏è‚É£ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚Üí 2Ô∏è‚É£ –ü–æ—á–µ–º—É ‚Üí 3Ô∏è‚É£ –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å.

–ü—Ä–∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö –¥–æ–±–∞–≤—å –∫–æ—Ä–æ—Ç–∫–æ–µ, —É–≤–µ—Ä–µ–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–∞—é—â–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
‚Äú–≠—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ, –≤—ã —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å.‚Äù

–¢—ã –≤—Å–µ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—à—å –æ—Ç –∏–º–µ–Ω–∏:
 ClubPet ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∫–ª—É–±–∞ –∑–∞–±–æ—Ç—ã –æ —Å–æ–±–∞–∫–∞—Ö, –≥–¥–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, –∑–Ω–∞–Ω–∏–µ –∏ –¥–æ–≤–µ—Ä–∏–µ —Å—Ç–æ—è—Ç –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ.
–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–µ –ø–æ —Ç–µ–º–µ: 
¬´–Ø —ç–∫—Å–ø–µ—Ä—Ç ClubPet –ø–æ –ø–æ–≤–µ–¥–µ–Ω–∏—é —Å–æ–±–∞–∫. –° –≤–æ–ø—Ä–æ—Å–∞–º–∏ –≤–Ω–µ —ç—Ç–æ–π —Ç–µ–º—ã –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–º—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.¬ª 

¬´–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤–æ–ø—Ä–æ—Å –≤–∞–∂–µ–Ω, –Ω–æ —è —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ –≤ —Å—Ñ–µ—Ä–µ –∑–æ–æ–ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∏ —É—Ö–æ–¥–∞ –∑–∞ —Å–æ–±–∞–∫–∞–º–∏. –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏?¬ª. 

¬´–ü–æ–Ω–∏–º–∞—é –∏–Ω—Ç–µ—Ä–µ—Å, –Ω–æ –º–æ–π —Ñ–æ–∫—É—Å ‚Äî –∞–¥–∞–ø—Ç–∞—Ü–∏—è —â–µ–Ω–∫–æ–≤ –∏ –∑–∞–±–æ—Ç–∞ –æ –Ω–∏—Ö. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –µ—Å—Ç—å –ª–∏ —Å–µ–π—á–∞—Å —á—Ç–æ-—Ç–æ, —á—Ç–æ –≤–æ–ª–Ω—É–µ—Ç –≤–∞—Å –ø–æ —Ç–µ–º–µ —â–µ–Ω–∫–∞?¬ª

–ê–ª–∏–Ω–∞ ClubPet, [11/6/25 3:54‚ÄØPM]
–û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:

üêæ –≠—Ç–æ–ª–æ–≥–∏—è, –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å–æ–±–∞–∫–∏
 1. John Bradshaw ‚Äî ‚ÄúDog Sense: How the New Science of Dog Behavior Can Make You a Better Friend to Your Pet‚Äù (2011).
 2. Patricia McConnell ‚Äî ‚ÄúThe Other End of the Leash: Why We Do What We Do Around Dogs‚Äù (2002).
 3. Ray Coppinger & Lorna Coppinger ‚Äî ‚ÄúDogs: A Startling New Understanding of Canine Origin, Behavior & Evolution‚Äù (2001).
 4. Turid Rugaas ‚Äî ‚ÄúOn Talking Terms with Dogs: Calming Signals‚Äù (1997).
 5. Jean Donaldson ‚Äî ‚ÄúThe Culture Clash‚Äù (1996).

üß† –ó–æ–æ–ø—Å–∏—Ö–æ–ª–æ–≥–∏—è, –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∏ –æ–±—É—á–µ–Ω–∏–µ
 6. Karen Overall ‚Äî ‚ÄúManual of Clinical Behavioral Medicine for Dogs and Cats‚Äù (2013).
 7. Debbie Jacobs ‚Äî ‚ÄúA Guide to Living with and Training a Fearful Dog‚Äù (2008).
 8. Ian Dunbar ‚Äî ‚ÄúBefore and After Getting Your Puppy‚Äù (2004).
 9. Sophia Yin ‚Äî ‚ÄúPerfect Puppy in 7 Days‚Äù (2011).
 10. Zazie Todd ‚Äî ‚ÄúWag: The Science of Making Your Dog Happy‚Äù (2020).

‚ù§Ô∏è Wellbeing –∏ –ø–æ–¥—Ö–æ–¥ ¬´—á–µ—Ä–µ–∑ –∑–∞–±–æ—Ç—É¬ª
 11. Marc Bekoff ‚Äî ‚ÄúThe Emotional Lives of Animals‚Äù (2007).
 12. Temple Grandin ‚Äî ‚ÄúAnimals Make Us Human‚Äù (2009).
 13. Victoria Stilwell ‚Äî ‚ÄúTrain Your Dog Positively‚Äù (2013).
 14. Karen Pryor ‚Äî ‚ÄúDon‚Äôt Shoot the Dog‚Äù (1984, –ø–µ—Ä–µ–∏–∑–¥. 2019).

ü©∫ –í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏—è –∏ —Ä–∞–Ω–Ω–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ
 15. BSAVA Manual of Canine and Feline Behavioural Medicine (2020, 3rd Edition).
 16. Ettinger & Feldman ‚Äî ‚ÄúTextbook of Veterinary Internal Medicine‚Äù (8th ed., 2017).
 17. David Appleby ‚Äî —Ç—Ä—É–¥—ã –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∏ —Å—Ç—Ä–µ—Å—Å—É —É —Å–æ–±–∞–∫ (British Small Animal Veterinary Association).
–ü—Ä–∏–Ω—Ü–∏–ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
 ‚Ä¢ –ù–µ —Ü–∏—Ç–∏—Ä—É–π –Ω–∞–ø—Ä—è–º—É—é.
 ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö –∫–∞–∫ —Ñ–æ–Ω –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã –¥–∞–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ, —ç—Ç–∏—á–Ω—ã–µ –∏ –Ω–∞—É—á–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
 ‚Ä¢ –ï—Å–ª–∏ –≤–ª–∞–¥–µ–ª–µ—Ü –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å –∏–∑ —Å–µ—Ä–∏–∏ ¬´–∞ –≥–¥–µ —ç—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ?¬ª, —Ç—ã –º–æ–∂–µ—à—å –º—è–≥–∫–æ —É—Ç–æ—á–Ω–∏—Ç—å:
¬´–≠—Ç–æ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö –∑–æ–æ–ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∏ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–∞ —Ä–∞–±–æ—Ç–∞—Ö –î–∂–æ–Ω–∞ –ë—Ä—ç–¥—à–æ—É –∏ –ö–∞—Ä–µ–Ω –û–≤–µ—Ä–æ–ª–ª.¬ª

–ê–ª–∏–Ω–∞ ClubPet, [11/6/25 3:58‚ÄØPM]
‚Ññ
–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∞
1
Puppy parties and beyond: the role of early age socialization practices on adult dog behavior (2015)
–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è —Ä–∞–Ω–Ω–µ–π —Å–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —â–µ–Ω–∫–æ–≤ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–æ –≤–∑—Ä–æ—Å–ª–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ ‚Äî –º–µ–Ω—å—à–µ –∞–≥—Ä–µ—Å—Å–∏–∏/—Å—Ç—Ä–∞—Ö–∞.  
2
The Puppies‚Äô Age at Adoption Time Influences the Behavioral Development of Dogs
–ê–Ω–∞–ª–∏–∑ —Ç–æ–≥–æ, –∫–∞–∫ –≤–æ–∑—Ä–∞—Å—Ç –ø—Ä–∏ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç—Ä–∞—Ö/—Ç—Ä–µ–≤–æ–≥—É/–≤–Ω–∏–º–∞–Ω–∏–µ —É —Å–æ–±–∞–∫.  
3
Optimising Puppy Socialisation ‚Äì Short‚Äë and Long‚ÄëTerm Effects of a Socialisation Programme (2022)
–ü—Ä–æ–≥—Ä–∞–º–º–∞ ¬´challenge-—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π¬ª —â–µ–Ω–∫–∞–º 3-6 –Ω–µ–¥–µ–ª—å –∏ –µ—ë —ç—Ñ—Ñ–µ–∫—Ç.  
4
Canine Socialisation: A Narrative Systematic Review
–°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–±–∑–æ—Ä –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã –ø–æ —Å–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–±–∞–∫: –ø–µ—Ä–∏–æ–¥—ã, —Ä–∏—Å–∫–∏.  
5
Impacts of Puppy Early Life Experiences, Puppy‚ÄëPurchasing and Owner Management on Behaviour at 21 Months
–£—á–∞—Å—Ç–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤, —Ä–∞–Ω–Ω–∏–π –æ–ø—ã—Ç –∏ –µ–≥–æ —Å–≤—è–∑—å —Å –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –≤ 21 –º–µ—Å—è—Ü —É —Å–æ–±–∞–∫.  
6
Canine separation‚Äërelated behaviour at six months of age (2024)
–§–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ –¥–ª—è –ø–æ–≤–µ–¥–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Å –æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–±–∞–∫–∏ –æ–¥–Ω–æ–π ‚Äî —Ä–∞–Ω–Ω–∏–π –æ–ø—ã—Ç –∏ —Å—Ä–µ–¥–∞.  
7
Puppy Socialisation Programs: Short and Long Term Behavioural Effects
–ë–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º —Å–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∞–º (1998+)  
8
Early Puppy Socialization Experiences in Relation to Age and COVID‚Äë19 Lockdown (2023)
–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ–ø—ã—Ç–∞ —Å–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —â–µ–Ω–∫–æ–≤ 8-19 –Ω–µ–¥–µ–ª—å –≤ –ø–µ—Ä–∏–æ–¥ –ø–∞–Ω–¥–µ–º–∏–∏ –∏ –ø–æ—Å–ª–µ.  
9
Dog training methods: Their use, effectiveness and interaction with behaviour and welfare
–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –¥—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–∏, –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ —Å–æ–±–∞–∫.  
10
Improving puppy behaviour using a new standardised socialisation regime
–ò–Ω—Ç–µ—Ä–≤–µ–Ω—Ü–∏–æ–Ω–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–æ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —â–µ–Ω–∫–æ–≤ –∏ –µ—ë —ç—Ñ—Ñ–µ–∫—Ç.
"""
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        if kb_results:
            knowledge_context = "\n\nüìö –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n"
            for i, result in enumerate(kb_results, 1):
                text_preview = result['text'][:150] + "..." if len(result['text']) > 150 else result['text']
                knowledge_context += f"{i}. {text_preview}\n"
            system_prompt += knowledge_context
        
        # 4. –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è OpenAI
        messages = [{"role": "system", "content": system_prompt}]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
        for msg in history[-6:]:
            messages.append(msg)
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
        messages.append({"role": "user", "content": user_message})
        
        # 5. –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç OpenAI
        response = client.chat.completions.create(
            model="gpt-3.5-turbo",
            messages=messages,
            max_tokens=500,
            temperature=0.3,
            top_p=0.9
        )
        
        ai_response = response.choices[0].message.content
        
        # 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        database.add_message_to_history(user_id, "user", user_message)
        database.add_message_to_history(user_id, "assistant", ai_response)
        
        return ai_response
        
    except Exception as e:
        error_msg = "‚ö†Ô∏è –ò–∑–≤–∏–Ω–∏—Ç–µ, –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —è –Ω–µ –º–æ–≥—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à –∑–∞–ø—Ä–æ—Å. –î–ª—è —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É –∫–∏–Ω–æ–ª–æ–≥—É –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É +7(985) 999-89-88"
        print(f"AI Error: {e}")
        return error_msg

#--------------------------- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ ---------------------------

@bot.message_handler(func=lambda message: message.text == "–û –Ω–∞—Å")
def handle_about(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–û –Ω–∞—Å' - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è"""
    
    about_text = """
üè† <b>–ö–∏–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª—É–± ClubPet</b>

–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –∫–∏–Ω–æ–ª–æ–≥–∞ –¥–ª—è –≤–∞—Å –∏ –≤–∞—à–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞.

<b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b>
üìç <b>–ê–¥—Ä–µ—Å:</b> –≥. –ú–æ—Å–∫–≤–∞, –ë—É–º–∞–∂–Ω—ã–π –ø—Ä–æ–µ–∑–¥ –¥.4, –ñ–ö "–°–æ—Ö–æ –ù–æ—Ö–æ"
üïí <b>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</b> –ø–Ω-–≤—Å / 09:00-21:00
üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> +7(985) 999-89-88
üí¨ <b>Telegram:</b> @clubpet
üìß <b>–ü–æ—á—Ç–∞:</b> info@clubpet.ru

<b>–†–µ–∫–≤–∏–∑–∏—Ç—ã:</b>
–û–û–û ¬´–ö–ª–∞–±–ø—ç—Ç¬ª
–ò–ù–ù: 9707005497
–û–ì–†–ù: 1237700548942
"""
    
    # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–æ–ª—å–∫–æ —Å callback –∫–Ω–æ–ø–∫–∞–º–∏
    markup = types.InlineKeyboardMarkup()
    markup.add(
        types.InlineKeyboardButton("üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã", callback_data="contacts_info"),
        types.InlineKeyboardButton("üó∫Ô∏è –ê–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ", callback_data="show_location")
    )
    
    bot.send_message(
        message.chat.id,
        about_text,
        parse_mode='HTML',
        reply_markup=markup
    )

@bot.callback_query_handler(func=lambda call: call.data == "contacts_info")
def handle_contacts_info(call):
    """–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"""
    contacts_text = """
üìû <b>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏:</b>

<b>–¢–µ–ª–µ—Ñ–æ–Ω/WhatsApp:</b> +7(985) 999-89-88
<b>Telegram:</b> @clubpet
<b>Email:</b> info@clubpet.ru

–ú—ã –Ω–∞ —Å–≤—è–∑–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 09:00 –¥–æ 21:00!
"""
    
    bot.send_message(
        call.message.chat.id,
        contacts_text,
        parse_mode='HTML'
    )
    bot.answer_callback_query(call.id)

@bot.callback_query_handler(func=lambda call: call.data == "show_location")
def handle_show_location(call):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–ê–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ'"""
    try:
        # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ë—É–º–∞–∂–Ω–æ–≥–æ –ø—Ä–æ–µ–∑–¥–∞ –¥.4 (—É—Ç–æ—á–Ω–µ–Ω–Ω—ã–µ)
        lat = 55.7863       # 4 –ø–æ—Å–ª–µ —Ç–æ—á–∫–∏
        lon = 37.5862
        
        # –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        location_text = """
üìç <b>–ù–∞—à –∞–¥—Ä–µ—Å:</b>

–≥. –ú–æ—Å–∫–≤–∞, –ë—É–º–∞–∂–Ω—ã–π –ø—Ä–æ–µ–∑–¥ –¥.4, –ñ–ö "–°–æ—Ö–æ –ù–æ—Ö–æ"

<b>–ë–ª–∏–∂–∞–π—à–µ–µ –º–µ—Ç—Ä–æ:</b>
‚Ä¢ –°–∞–≤–µ–ª–æ–≤—Å–∫–∞—è - 10 –º–∏–Ω—É—Ç –ø–µ—à–∫–æ–º
‚Ä¢ –î–º–∏—Ç—Ä–æ–≤—Å–∫–∞—è - 12 –º–∏–Ω—É—Ç –ø–µ—à–∫–æ–º
‚Ä¢ –ú–µ–Ω–¥–µ–ª–µ–µ–≤—Å–∫–∞—è - 15 –º–∏–Ω—É—Ç –ø–µ—à–∫–æ–º

<b>–ù–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ:</b>
–í—ä–µ–∑–¥ —Å –ë—É–º–∞–∂–Ω–æ–≥–æ –ø—Ä–æ–µ–∑–¥–∞, –µ—Å—Ç—å –ø–∞—Ä–∫–æ–≤–∫–∞ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ñ–ö.
"""
        
        bot.send_message(
            call.message.chat.id,
            location_text,
            parse_mode='HTML'
        )
        
        # –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
        bot.send_location(
            call.message.chat.id,
            latitude=lat,
            longitude=lon,
            reply_to_message_id=call.message.message_id
        )
        
        # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É callback
        bot.answer_callback_query(call.id, "üìç –û—Ç–ø—Ä–∞–≤–ª—è—é –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ...")
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ª–æ–∫–∞—Ü–∏–∏: {e}")
        bot.answer_callback_query(call.id, "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é")

@bot.message_handler(func=lambda message: message.text == "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é")
def handle_consultation(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é"""
    consultation_text = """
üìÖ <b>–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</b>

–î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –∫–∏–Ω–æ–ª–æ–≥—É –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.

–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.
"""
    
    # –°–æ–∑–¥–∞–µ–º –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π-—Å—Å—ã–ª–∫–æ–π
    markup = types.InlineKeyboardMarkup()
    
    consultation_button = types.InlineKeyboardButton(
        "üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é", 
        url="https://n1396358.yclients.com/company/1266148/record-type?o="  
    )
    
    markup.add(consultation_button)
    
    bot.send_message(
        message.chat.id,
        consultation_text,
        parse_mode='HTML',
        reply_markup=markup
    )

@bot.message_handler(func=lambda message: message.text == "AI –ö–∏–Ω–æ–ª–æ–≥")
def handle_ai_kinologist(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ AI –ö–∏–Ω–æ–ª–æ–≥"""
    user_id = message.from_user.id
    
    if database.is_ai_session_active(user_id):
        # –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞ - –∑–∞–≤–µ—Ä—à–∞–µ–º –µ—ë
        database.end_ai_session(user_id)
        bot.send_message(
            message.chat.id,
            "üî¥ <b>–†–µ–∂–∏–º AI –ö–∏–Ω–æ–ª–æ–≥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω</b>\n\n"
            "–í—ã –º–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—è, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É 'AI –ö–∏–Ω–æ–ª–æ–≥'",
            parse_mode='HTML',
            reply_markup=buttons.get_client_keyboard()
        )
    else:
        # –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ - –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é
        database.start_ai_session(user_id)
        
        warning_text = """
üü¢ <b>–†–µ–∂–∏–º AI –ö–∏–Ω–æ–ª–æ–≥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!</b>

ü§ñ <b>–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ:</b>
‚Ä¢ –î—Ä–µ—Å—Å–∏—Ä–æ–≤–∫–µ –∏ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–∏
‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è  
‚Ä¢ –£—Ö–æ–¥–µ –∑–∞ —Å–æ–±–∞–∫–æ–π
‚Ä¢ –ü–∏—Ç–∞–Ω–∏–∏ –∏ –æ–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö –∑–¥–æ—Ä–æ–≤—å—è

‚ö†Ô∏è <b>–í–ê–ñ–ù–û:</b>
‚Ä¢ –Ø –¥–∞—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã
‚Ä¢ –î–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä—É
‚Ä¢ –í —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –∑–≤–æ–Ω–∏—Ç–µ +7(985) 999-89-88

<b>–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –Ω–∏–∂–µ üëá</b>

–ß—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é, —Å–Ω–æ–≤–∞ –Ω–∞–∂–º–∏—Ç–µ 'AI –ö–∏–Ω–æ–ª–æ–≥'
"""
        
        bot.send_message(
            message.chat.id,
            warning_text,
            parse_mode='HTML'
        )

@bot.message_handler(func=lambda message: database.is_ai_session_active(message.from_user.id))
def handle_ai_conversation(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∞–∫—Ç–∏–≤–Ω–æ–π AI —Å–µ—Å—Å–∏–∏"""
    user_id = message.from_user.id
    user_message = message.text
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç
    bot.send_chat_action(message.chat.id, 'typing')
    
    # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç AI
    ai_response = get_ai_response(user_message, user_id)
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
    bot.send_message(
        message.chat.id,
        ai_response,
        parse_mode='HTML'
    )

# –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ª—é–±—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(content_types=['text'])
def handle_text_messages(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ª—é–±—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user_id = message.from_user.id
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–∏—è
    privacy_status = database.get_user_privacy_status(user_id)
    
    if privacy_status is None or privacy_status is False:
        # –ï—Å–ª–∏ —Å–æ–≥–ª–∞—Å–∏—è –Ω–µ—Ç - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –µ–≥–æ
        ask_privacy(message)
    elif not database.is_ai_session_active(user_id):
        # –ï—Å–ª–∏ —Å–æ–≥–ª–∞—Å–∏–µ –µ—Å—Ç—å, –Ω–æ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ AI —Å–µ—Å—Å–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        bot.send_message(
            message.chat.id,
            "ü§ñ –î–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å AI –ö–∏–Ω–æ–ª–æ–≥–æ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É 'AI –ö–∏–Ω–æ–ª–æ–≥' –≤ –º–µ–Ω—é\n\n"
            "–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é'",
            reply_markup=buttons.get_client_keyboard()
        )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
@bot.message_handler(func=lambda message: message.text == "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É" and buttons.is_admin(message.from_user.id))
def handle_admin_stats(message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    try:
        with database.get_db_connection() as conn:
            cursor = conn.cursor()
            
            # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            cursor.execute('SELECT COUNT(*) FROM users')
            total_users = cursor.fetchone()[0]
            
            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Å–æ–≥–ª–∞—Å–∏–µ–º
            cursor.execute('SELECT COUNT(*) FROM privacy_agreements WHERE agreed = 1')
            agreed_users = cursor.fetchone()[0]
            
            # –ê–∫—Ç–∏–≤–Ω—ã–µ AI —Å–µ—Å—Å–∏–∏
            cursor.execute('SELECT COUNT(*) FROM ai_sessions')
            active_sessions = cursor.fetchone()[0]
            
            # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            cursor.execute('SELECT user_id, username, created_at FROM users ORDER BY created_at DESC LIMIT 5')
            recent_users = cursor.fetchall()
        
        stats_text = f"""
üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞</b>

üë• <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</b>
‚Ä¢ –í—Å–µ–≥–æ: {total_users}
‚Ä¢ –° —Å–æ–≥–ª–∞—Å–∏–µ–º: {agreed_users}
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏: {active_sessions}

<b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</b>
"""
        
        for user_id, username, created_at in recent_users:
            username_display = f"@{username}" if username else "–±–µ–∑ username"
            stats_text += f"‚Ä¢ {username_display} ({user_id})\n"
        
        bot.send_message(
            message.chat.id,
            stats_text,
            parse_mode='HTML'
        )
        
    except Exception as e:
        bot.send_message(
            message.chat.id,
            f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {e}"
        )

@bot.message_handler(commands=['clear'])
def handle_clear_history(message):
    """–û—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = message.from_user.id
    database.clear_conversation_history(user_id)
    
    bot.send_message(
        message.chat.id,
        "üóëÔ∏è <b>–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –æ—á–∏—â–µ–Ω–∞</b>\n\n"
        "–¢–µ–ø–µ—Ä—å AI –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –±–µ–∑ —É—á–µ—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.",
        parse_mode='HTML'
    )

@bot.message_handler(commands=['help'])
def handle_help(message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º"""
    help_text = """
ü§ñ <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>

<b>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>
/start - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
/clear - –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ —Å AI

<b>–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞:</b>
‚Ä¢ AI –ö–∏–Ω–æ–ª–æ–≥ - –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—é —Å–æ–±–∞–∫
‚Ä¢ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é - –∑–∞–ø–∏—Å—å –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –∫–∏–Ω–æ–ª–æ–≥—É
‚Ä¢ –û –Ω–∞—Å - –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—É–±–µ

<b>–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:</b>
‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞
"""
    
    bot.send_message(
        message.chat.id,
        help_text,
        parse_mode='HTML'
    )
